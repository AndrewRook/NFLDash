<html>
	<head>
		<title>NFLDash</title>

		<meta http-equiv="content-type" content="text/html; charset=UTF8"> 

		<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
		<script type="text/javascript" src="{{ url_for('static', filename='d3/d3.js') }}"></script>
		<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.0.0/d3.min.js"></script> -->
		
		<!-- <script type="text/javascript" src="https://rawgithub.com/NickQiZhu/dc.js/master/web/js/crossfilter.js"></script> -->
		<script type="text/javascript" src="{{ url_for('static', filename='crossfilter/crossfilter.js') }}"></script>

		<!-- <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.min.js"></script>
		<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.min.css"/> -->
		
		<script type="text/javascript" src="{{ url_for('static', filename='dc/dc.js') }}"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dc/dc.css') }}" media="screen" />
	</head>
	
	<body>
		<div id="chart_ring_year"></div>
		<div id="chart_line_hitsperday"></div>
		
		<script type="text/javascript">
		d3.csv("{{ url_for('static', filename='test.csv') }}", function(data)
			{
				data.forEach(function(d)
					{
						d.http_404 = +d.http_404;
						d.http_200 = +d.http_200;
						d.http_302 = +d.http_302;
					});

				var ndx = crossfilter(data);
				
				var parse_date = d3.time.format("%m/%d/%Y").parse;
				
				data.forEach(function(d) {
					d.date = parse_date(d.date);
					d.total = d.http_404 + d.http_200 + d.http_302;
					
					d.year = d.date.getFullYear();
				});
				
				var date_dim = ndx.dimension(function(d) {return d.date;});
				var hits = date_dim.group().reduceSum(function(d) {return d.total;});
				
				var min_date = date_dim.bottom(1)[0].date;
				var max_date = date_dim.top(1)[0].date;
				
				var hits_line_chart = dc.lineChart("#chart_line_hitsperday");
				hits_line_chart
					.width(500).height(200)
					.dimension(date_dim)
					.group(hits)
					.x(d3.time.scale().domain([min_date, max_date]))
					.brushOn(false)
					.yAxisLabel("Hits per day");
				
				var year_ring_chart = dc.pieChart("#chart_ring_year");
				var year_dim = ndx.dimension(function(d) {return + d.year;});
				var year_total = year_dim.group().reduceSum(function(d) {
					return d.http_200 + d.http_302;
				});
				
				year_ring_chart
					.width(150).height(150)
					.dimension(year_dim)
					.group(year_total)
					.innerRadius(30);
				
				dc.renderAll();
			});
		</script>
	</body>
</html>
