
<html>
	<head>
		<title></title>

		<meta http-equiv="content-type" content="text/html; charset=UTF8">

		<script type="text/javascript" src="{{ url_for('static', filename='jquery/jquery-3.1.0.min.js') }}"></script>

		<script type="text/javascript" src="{{ url_for('static', filename='d3/d3.js') }}"></script>
		
		<script type="text/javascript" src="{{ url_for('static', filename='crossfilter-1.4.0-alpha.06/crossfilter.js') }}"></script>

		
		<script type="text/javascript" src="{{ url_for('static', filename='dc.js-develop/dc.js') }}"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dc.js-develop/dc.css') }}" media="screen" />

		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" />
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.min.css') }}" />
		<script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>

		<!-- Latest compiled and minified CSS -->
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.0/css/bootstrap-select.min.css"> -->
		<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-select-1.11.0/dist/css/bootstrap-select.min.css') }}" />
		<!-- Latest compiled and minified JavaScript -->
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.0/js/bootstrap-select.min.js"></script>-->
		<script type="text/javascript" src="{{ url_for('static', filename='bootstrap-select-1.11.0/dist/js/bootstrap-select.js') }}"></script>

	</head>
	
	<body>
		
		<span>
			<div id="ytg-chart"></div>
			<div id="yardline-chart"></div>
			<!-- <div id="player-chart"></div> -->
			<!-- <div class="list-group" id="player-list"> -->
			</div>
			<br>

			<div id="qb-select"></div>
		</span>

		<script>
		$(document).ready(function()
			{
				$.get("{{ url_for('static', filename='players.csv') }}", function(player_string)
					{
						players = player_string.split(/\r\n|\r|\n/g);
						player_dict = {};
						for (var i = 0; i < players.length; i++)
						{
							var player_info = players[i].split(",");
							player_dict[player_info[0]] = {"name": player_info[1],
								                       "position": player_info[2]};
						}
						
						d3.csv("{{ url_for('static', filename='plays.csv') }}", function(row)
							{
								//console.log(row.player_ids, row.player_ids.length);
								row.player_ids = row.player_ids.replace(/[ \'u\[\]]/g, '').split(",");
								return row;
							},
							function(data)
							{
								
								var cf = crossfilter(data);
								//Yardline bar
								var yardline_dim = cf.dimension(function(d) {return d.yardline;});
								var yardline_group = yardline_dim.group();
								var yardline_chart = dc.barChart("#yardline-chart");
								yardline_chart
									.dimension(yardline_dim)
									.group(yardline_group)
									.x(d3.scale.linear().domain([-50, 50]))
									.elasticY(true)
									.width(500).height(200);
								
								// YARDS TO GO PIE
								var ytg_dim = cf.dimension(function(d){ return d.yards_to_go;});
								var ytg_group = ytg_dim.group();
								var ytg_chart = dc.pieChart("#ytg-chart");
								ytg_chart
									.dimension(ytg_dim)
									.group(ytg_group)
									.width(200).height(200).innerRadius(50);
								
								var qb_dim = cf.dimension(function(d){ return d.player_ids;}, true);
								var qb_group = qb_dim.group();
								var qb_select = dc.selectMenu("#qb-select");
								qb_select
									.dimension(qb_dim)
									.group(qb_group)
									.filterDisplayed(function (d) {
										console.log(player_dict[d.key]["position"]);
										if (player_dict[d.key]["position"] == "QB")
										{
											return true;
										}
										else
										{
											return false;
										}
									})
									.multiple(true)
									.order(function (a, b) {
										//Handle cases where there is no name:
										if (player_dict[a.key]["name"] == "") {return 1;}
										if (player_dict[b.key]["name"] == "") {return -1;}
										
										if (player_dict[a.key]["name"] > player_dict[b.key]["name"])
										{
											return 1;
										}
										else if (player_dict[b.key]["name"] > player_dict[a.key]["name"])
										{
											return -1;
										}
										else
										{return 0;}
									})
									.title(function(d) {
										if (player_dict[d.key]["name"] !== "")
										{
											return player_dict[d.key]["name"] + ": " + d.value;
										}
										else
										{return d.key + ": " + d.value;}
									})
									;
								
								dc.renderAll();
								var qb_selector = $("#qb-select").children("select")[0];
								$(qb_selector).addClass("selectpicker");
								$(qb_selector).attr("data-live-search", "true");
								$(qb_selector).attr("title", "QBs");
								$(qb_selector).selectpicker('refresh'); 
							});
						
					});
			});
		</script>
	</body>
</html>
